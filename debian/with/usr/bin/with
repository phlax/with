#!/bin/bash

OWD=`pwd`

ARGS=($@)
CMD=$1

touch ~/.with
data=`cat ~/.with`

if [ "$data" == "" ]; then
    echo "{}" > ~/.with
    data="{}"
fi


delegate_command () {
    COMMAND=${ARGS[@]:1}
    $COMMAND
}


case $CMD in
    @get | @unset )
	KV="${CMD[@]:1}"
	kv with $KV $2
	;;
    @dump | @list )
	KV="${CMD[@]:1}"
	kv with $KV ;;
    "@set" )
	kv with set $2 $(realpath $3) ;;
    *)
	cwd=$(echo $data | jq -r ".$1")
	cd $cwd >> /dev/null
	delegate_command
	cd - >> /dev/null
	;;

esac
